# Ativa mod_rewrite e mod_proxy (requer Apache com suporte)
RewriteEngine On
RewriteBase /

# Evita loop de proxy
RewriteCond %{HTTP:X-Forwarded-For} !=""
RewriteRule .* - [E=PROXY:1]

# Passa requisições de build estático do Next.js
RewriteCond %{REQUEST_URI} ^/_next/ [OR]
RewriteCond %{REQUEST_URI} ^/static/ [OR]
RewriteCond %{REQUEST_URI} ^/favicon\.ico$ [OR]
RewriteCond %{REQUEST_URI} ^/assets/ [OR]
RewriteCond %{REQUEST_URI} ^/robots\.txt$ [OR]
RewriteCond %{REQUEST_URI} ^/sitemap\.xml$
RewriteRule ^(.*)$ http://127.0.0.1:21092/$1 [P,L]

# Redireciona todas as demais rotas para o app Next.js
RewriteCond %{REQUEST_URI} !^/_next/
RewriteRule ^(.*)$ http://127.0.0.1:21092/$1 [P,L]

# Impede cache agressivo em conteúdo dinâmico
<IfModule mod_headers.c>
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires 0
</IfModule>

# Opcional: redireciona HTTP -> HTTPS
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]